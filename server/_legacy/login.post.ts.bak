import { db } from '../api/_db'

export default defineEventHandler(async (e) => {
  const body = await readBody<{ username: string; password: string }>(e)
  const u = body?.username ? db.users.get(body.username) : null
  if (!u || u.password !== body.password) {
    throw createError({ statusCode: 401, statusMessage: 'Неверный логин или пароль' })
  }
  return { token: u.token }
})
